# SQL Files Documentation

## Overview
This directory contains PostgreSQL-compatible SQL files for importing NAPPS Nasarawa State Unified Exams 2025 data into a Neon database.

**Last Updated:** June 4, 2025

## Files Description

### Data Import Files
- **`chapters.sql`** - Chapter data (19 records)
- **`schools.sql`** - School data (932 records) 
- **`centers.sql`** - Exam center data (93 records)
- **`coordinators.sql`** - Chapter coordinator data (7 records)
- **`registrations.sql`** - Student registration data (76 records)

### Utility Scripts
- **`import-all.sql`** - Master import script that runs all data files in correct order
- **`validate-data.sql`** - Data validation and integrity checking script

## Prerequisites

1. **PostgreSQL Database**: Ensure you have a PostgreSQL database (Neon) with the proper schema
2. **Schema**: The database schema must be created first (run `db/schema.sql`)
3. **Permissions**: Database user must have INSERT, UPDATE, and SELECT permissions

## Usage Instructions

### Option 1: Import All Data (Recommended)
```bash
# Connect to your Neon database and run:
\i import-all.sql
```

### Option 2: Import Individual Files
```bash
# Import in dependency order:
\i chapters.sql
\i schools.sql  
\i centers.sql
\i coordinators.sql
\i registrations.sql
```

### Option 3: Using psql Command Line
```bash
# From terminal (replace connection details):
psql -h your-host -d your-database -U your-user -f import-all.sql
```

## Data Validation

After importing, run the validation script:
```bash
\i validate-data.sql
```

This will check for:
- Referential integrity issues
- Data quality problems
- Summary statistics
- Duplicate records

## Data Summary

| Table | Records | Description |
|-------|---------|-------------|
| chapters | 19 | Exam chapters/locations |
| schools | 932 | Participating schools |
| centers | 93 | Exam centers |
| chapter_coordinators | 7 | Chapter coordinators |
| registrations | 76 | Student registrations |

## Key Features

✅ **PostgreSQL Compatible** - All files formatted for PostgreSQL/Neon  
✅ **Transaction Safe** - Each file wrapped in BEGIN/COMMIT  
✅ **Conflict Resolution** - Uses `ON CONFLICT DO UPDATE` for safe re-runs  
✅ **Sequence Management** - Properly updates auto-increment sequences  
✅ **Error Handling** - Proper escaping of special characters  
✅ **Import Logging** - Detailed progress and completion messages  

## Common Issues & Solutions

### Issue: Syntax Error with Apostrophes
**Solution:** All single quotes in data have been properly escaped with double quotes (`''`)

### Issue: Foreign Key Violations
**Solution:** Files are ordered by dependencies. Always import chapters first.

### Issue: Duplicate Key Errors
**Solution:** Files use `ON CONFLICT DO UPDATE` to handle duplicates safely

### Issue: Sequence Out of Sync
**Solution:** Each file includes `setval()` commands to sync sequences

## File Format Details

Each SQL file follows this structure:
```sql
-- Header with metadata
BEGIN;
-- Data insertion with conflict resolution
-- Sequence updates
COMMIT;
-- Summary messages
```

## Development Notes

- Original data converted from MySQL dumps
- All school names cleaned and properly escaped
- Registration data includes payment status tracking
- Coordinator data includes unique codes for authentication
- Center assignments properly linked to chapters

## Support

If you encounter issues:
1. Check the validation script output
2. Verify database schema is up to date
3. Ensure proper PostgreSQL permissions
4. Check Neon connection settings

---
**Generated by:** NAPPS Data Import Tool  
**Contact:** System Administrator
